{% extends 'base.html' %}
{% load static %}
{% block title %}Заказ #{{ order.id }}{% endblock %}

{% block header %}Детали заказа #{{ order.id }}{% endblock %}

{% block content %}
<link href="{% static 'styles/order_detail.css' %}" rel="stylesheet">
<div class="order-detail-container">
    <div class="order-header">
        <h2>Заказ #{{ order.id }}</h2>
        <span class="status-badge status-{{ order.status }}">
            {{ order.get_status_display }}
        </span>
    </div>

    <div class="order-info">
        <div class="info-section">
            <h3>Информация о заказе</h3>
            <table class="info-table">
                <tr>
                    <td><strong>Номер заказа:</strong></td>
                    <td>#{{ order.id }}</td>
                </tr>
                <tr>
                    <td><strong>Дата создания:</strong></td>
                    <td>{{ order.date_created|date:"d.m.Y H:i" }}</td>
                </tr>
                <tr>
                    <td><strong>Статус:</strong></td>
                    <td>
                        {% if order.status == 'processing' %}
                            <span class="status-text status-processing">⏳ В обработке</span>
                        {% elif order.status == 'confirmed' %}
                            <span class="status-text status-confirmed">✓ Подтвержден</span>
                        {% elif order.status == 'completed' %}
                            <span class="status-text status-completed">✓ Завершен</span>
                        {% elif order.status == 'cancelled' %}
                            <span class="status-text status-cancelled">✗ Отменен</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td><strong>Оплачен:</strong></td>
                    <td>
                        {% if order.is_paid %}
                            <span class="paid-status paid">✓ Да</span>
                        {% else %}
                            <span class="paid-status unpaid">✗ Нет</span>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>

        <div class="info-section">
            <h3>Товары в заказе ({{ order.order_items.count }})</h3>
            <div class="items-list">
                {% for item in order.order_items.all %}
                    <div class="order-item">
                        <div class="item-info">
                            {% if item.image %}
                                <img src="{{ item.image.url }}" alt="{{ item.product_name }}" class="item-image">
                            {% else %}
                                <div class="item-image-placeholder">Нет изображения</div>
                            {% endif %}
                            <div class="item-details">
                                <h4>{{ item.product_name }}</h4>
                                <p class="manufacturer">Производитель: {{ item.manufacturer|default:"Не указан" }}</p>
                                <p class="quantity">Количество: {{ item.quantity }}</p>
                                <p class="description">{{ item.description|truncatewords:15 }}</p>
                            </div>
                        </div>
                        <div class="item-price">
                            <p class="price">{{ item.product_price }} ₽</p>
                            <p class="total">Всего: {{ item.get_total_price }} ₽</p>
                        </div>
                    </div>
                {% empty %}
                    <p class="no-items">В заказе нет товаров</p>
                {% endfor %}
            </div>
        </div>

        <div class="order-total">
            <h3>Итого к оплате: <span class="total-amount">{{ order.total_price }} ₽</span></h3>
        </div>
    </div>

    <div class="order-actions">
        <a href="{% url 'order_history' %}" class="btn btn-secondary">Вернуться к истории</a>
        <a href="{% url 'products' %}" class="btn btn-primary">Продолжить покупки</a>
    </div>
</div>
{% endblock %}
